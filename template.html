<style>

    body {
        margin-top: 60px;
    }

    h3{
        font-size: 22px;
    }

    p{
        font-weight: 200;
        font-size: 16px;
    }

    .green {
        color:#43B191;
    }

    .dark-color{color: rgba(0, 0, 0, 0.7);}

    .secondnav {
        position: fixed;
        top: 0px;
        z-index: 999;
        background-color: #43B191;
        width: 100%;
        height: 60px;
        right: 0;
    }

    .fa-funnel {
        font-size: 24px !important;
        color: white;
    }

    .fa-funnel.step2 {
        background-color: #2E9380;
    }

    .fa-funnel.step3 {
        background-color: #114F43;
    }


    .navbar-brand {
        padding: 17px 15px;
        width: 0;
    }

    .navbar-info-btn {
        position: absolute;
        top: 20px;
        float: left;
        margin-left: 3%;
    }

    .navbar-close-btn {
        position: absolute;
        top: 19px;
        float: right;
        margin-left: 92%;
    }

    .btn-tutorial {
        background: white;
        color: #2E4B63;
        text-transform: uppercase;
        width: 100%;
        height: 45px;
        padding-top: 11px;
        font-weight: 600;
        margin-top: 20px;
    }

    .help-full {
        display: none;
        position: absolute;
        top: 0;
        background-color: #2B9884;
        left: 0;
        height: 100%;
        width: 100%;
        z-index: 99999999999999999999999999999;
        color: white;
    }

    .help2-1 h4,
    .help2-2 h4{
       font-size: 13px;
       font-style: italic;
    }

    .help2-1 ul,
    .help2-2 ul {
        font-size: 16px;
        text-align: left;
    }

    .help2-1 ul > li,
    .help2-2 ul > li {
        margin-bottom: 8px;
    }




    .swiper-container {
        width: 100%;
        height: 240px;
        border: 1px solid transparent;
        margin-top: 0px;
    }

    @media(min-width: 768px) {
        .swiper-container {
            margin-top: 35px;
        }
    }
    .swiper-slide {
        text-align: center;
        font-size: 18px;
        background: #fff;
        /* Center slide text vertically */
        display: -webkit-box;
        display: -ms-flexbox;
        display: -webkit-flex;
        display: flex;
        -webkit-box-pack: center;
        -ms-flex-pack: center;
        -webkit-justify-content: center;
        justify-content: center;
        -webkit-box-align: center;
        -ms-flex-align: center;
        -webkit-align-items: center;
        align-items: center;
    }


    .swiper-pagination-bullet {
        margin: 2px;
        background: #9ba9b0;
        display: none;  // hide the pagination bullet for now
    }
    .swiper-pagination-bullet-active {
        background: #546E7A;
    }
    .btn-group-answer-bottom {
        border-top: 1px solid #9ba9b0;
        bottom:0;
        width:100%;
        background: white;
        margin-right: 0px;
        margin-left: 0px;
        position: fixed;
        z-index: 1;
        min-height: 100px;
    }

    .btn-group-answer-bottom.mini {
        min-height: 0px;
    }
    .btn-group-answer-bottom button {
        padding-left: 0;
        padding-right: 0;
        height: 50px;
    }

    .btn-group-answer-bottom .col-xs-6 button,
    .btn-group-answer-bottom .col-xs-4 button{
        padding-left: 0px;
        padding-right: 0px;
        min-height: 60px;
    }

    .btn-group-answer-bottom .left {
        border-right: 1px solid #9ba9b0;
    }

    .btn-white {
        background: white;
        margin-top: 0;
        color: #43B191 !important;
        border: 0px !important;
        margin-bottom: 0px;
    }

    .btn-white:active,
    .btn-white:focus,
    .btn-white:hover {
        background: white;
        box-shadow: none;
        outline: none !important;
    }

    .no-margin {
        margin: 0;
    }

    .btn-extra-step {
        display: inline-block;
        background-color: #E9E9E9;
        border-radius: 0px;
        color: black !important;
        height: 40px;
    }

    .btn-xlarge {
        padding: 18px 28px;
        font-size: 22px; //change this to your desired size
        line-height: normal;
        -webkit-border-radius: 8px;
           -moz-border-radius: 8px;
                border-radius: 8px;
    }

    #stage {
        display: none;
        border: 1px solid #9ba9b0;
    }
    .step-icon {
        min-height: 130px !important;
    }

    @media (min-width: 768px) {
        #stage {
            margin-top: 35px;
        }
    }

    .close-icon {
        position:relative;
        background: rgba(0,0,0,0.5);
        color: white;
        z-index:999;
        padding-top: 4px;
        padding-bottom: 2px;
        border-radius: 5px;
        margin-top: 15px;
        margin-right: 15px;
    }

    .step1,
    .step2,
    .step3,
    .step3.tiger,
    .step3.yellow,
    .step4 {
        display:none;
    }

    .zoom-info {
        margin-top: 10px;
        font-size: 13px;
    }

    .mobileHoverFix:hover,
    .mobileHoverFix.hover,
    .mobileHoverFix:focus,
    .mobileHoverFix.focus{
        color: #546e7b;
    }

    /* #question {
        margin-top:35px;
    }*/

    #question h4 {
        font-size: 16px;
        color: white;
        margin-top: 23px;
    }

    .help-full{
        display: none;
        position: absolute;
        top: 0;
        background-color: #2B9884;
        left: 0;
        height: 100%;
        width: 100%;
        z-index: 99999999999999999999999999999;
        color: white;
    }
    .help-full p {
        color: white;
    }

    .non-readable {
        width: 100%;
        position: fixed;
        bottom: 60px;
    }
    .non-readable a {
        font-size: 12px;
    }

    .bodyparts {
        text-align: center;
    }

    .bodyparts > img {
        display: inline-block;
    }

</style>
<script src="/static/js/vendor/hammer.min.js"></script>
<link rel="https://cdnjs.cloudflare.com/ajax/libs/ol3/3.16.0/ol.css" rel="stylesheet" type="text/css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/ol3/3.16.0/ol.js"></script>
<div id="help1container" class="container help-full help1">
    <div class="row">
        <div class="col-xs-12 col-md-offset-4 col-md-4 text-center">
            <h2>Mosquito Alert</h2>
            <img src="http://i.imgur.com/1MY0zqo.png" style="height:130px;">
            <h3 id="i18n_question1" class="dark-color">¿Ves un mosquito en esta foto?</h3>
            <p id="i18n_easy_right">Parece fácil, ¿verdad?</p>
            <p id="i18n_tellme">Pues dinos si ves un mosquito.</p>
        </div>
        <div class="col-md-12" style="text-align:center;">
            <a id="help1" href="#" class="btn btn-tutorial">
                <span id="i18n_letsgo">¡Vamos allá!</span></a>
        </div>
    </div>
</div>
<div id="help2container" class="container help-full help2">
    <div class="row">
        <div class="col-xs-12 col-md-offset-4 col-md-4 text-center">
            <h2>Mosquito Alert</h2>
            <img src="http://i.imgur.com/hYdlg8M.png" style="height:130px;">
            <h3 id="i18n_whatmosquito" class="dark-title">¿Qué mosquito es?</h3>
            <p id="i18n_wesearch">Buscamos mosquitos tigre o mosquitos de la fiebre amarilla, pero se pueden colar otras especies</p>
            <p id="i18n_nextscreen">En la pantalla siguiente te explicamos cómo reconocerlos.</p>
        </div>
        <div class="col-md-12" style="text-align:center;">
            <a id="help2" href="#" class="btn btn-tutorial">
                <span id="i18n_ok">¡Vale!</span></a>
        </div>
    </div>
</div>
<div id="help2-1container" class="container help-full help2-1">
    <div class="row">
        <div class="col-xs-12 col-md-offset-4 col-md-4 text-center">
            <h2>Mosquito Alert</h2>
            <h3 id="i18n_tiger" class="dark-color">Mosquito Tigre</h3>
            <h4>(Aedes albopictus)</h4>
            <ul>
                <li id="i18n_whitestripes">Es pequeño (< 1 cm), negro y con rayas blancas horizontales en el abodmen.</li>
                <li id="i18n_whitelinehead">Tiene una línea blanca vertical en cabeza y tórax.</li>
                <li id="i18n_stripedlegs">Patas rayadas.</li>
            </ul>
            <h3 id="i18n_examples">Ejemplos</h3>
            <div class="row">
                <div class="col-xs-6">
                    <img src="http://i.imgur.com/PHPuc8l.png" width="100px">
                    <p id="i18n_torax">Tórax</p>
                </div>
                <div class="col-xs-6">
                    <img src="http://i.imgur.com/8uccfud.png" width="100px">
                    <p id="i18n_abdomen">Abdomen</p>
                </div>
            </div>

        </div>
        <div class="col-md-12" style="text-align:center;">
            <a id="help2-1" href="#" class="btn btn-tutorial">
                <span id="i18n_ok2">¡OK!</span></a>
        </div>
    </div>
</div>
<div id="help2-2container" class="container help-full help2-2">
    <div class="row">
        <div class="col-xs-12 col-md-offset-4 col-md-4 text-center">
            <h2>Mosquito Alert</h2>
            <h3 id=""i18n_yellowfever" class="dark-color">Mosquito de Fiebre Amarilla</h3>
            <h4>(Aedes aegypti)</h4>
            <ul>
                <li id="i18n_smallblackish">Es pequeño (< 1 cm), marrón negruzco y con rayas horizontales, blancas y anchas en el abdomen. A cada lado de estas líneas tiene manchas blancas redondas.</li>
                <li id="i18n_patternchest">Tiene un dibujo en forma de lira en el tórax.</li>
                <li id="i18n_stripedlegs2">Patas rayadas.</li>
            </ul>
            <h3 id="i18n_examples2">Ejemplos</h3>
            <div class="row">
                <div class="col-xs-6">
                    <img src="http://i.imgur.com/hZlv8lr.png" width="100px">
                    <p id="i18n_torax2">Tórax</p>
                </div>
                <div class="col-xs-6">
                    <img src="http://i.imgur.com/9gkaHlD.png" width="100px">
                    <p id="i18n_abdomen2">Abdomen</p>
                </div>
            </div>

        </div>
        <div class="col-md-12" style="text-align:center;">
            <a id="help2-2" href="#" class="btn btn-tutorial">
                <span id="i18n_ok3">¡OK!</span></a>
        </div>
    </div>
</div>

<div id="help3container" class="container help-full help3">
    <div class="row">
        <div class="col-xs-12 col-md-offset-4 col-md-4 text-center">
            <h3 id="i18n_whichparts" class="dark-color">¿Por qué partes lo has reconocido?</h3>
            <p id="i18n_markparts">Marca aquellas partes del mosquito que te han ayudado a identificarlo: su tórax o abdomen (puedes marcar las dos).</p>
            <h3 id="i18n_tigermosquito">Mosquito Tigre</h3>
            <div class="row">
                <div class="col-xs-6">
                    <img src="http://i.imgur.com/gJ3fH2o.png" width="100px">
                    <p id="i18n_torax3">Tórax</p>
                </div>
                <div class="col-xs-6">
                    <img src="/http://i.imgur.com/8uccfud.png" width="100px">
                    <p id="i18n_abdomen3">Abdomen</p>
                </div>
            </div>

            <h3 id="i18n_yellowfever2">Mosquito Fiebre Amarilla</h3>
            <div class="row">
                <div class="col-xs-6">
                    <img src="http://i.imgur.com/87xWKZF.png" width="100px">
                    <p id="i18n_torax4">Tórax</p>
                </div>
                <div class="col-xs-6">
                    <img src="http://i.imgur.com/vWrIntO.png" width="100px">
                    <p id="i18n_abdomen4">Abdomen</p>
                </div>
            </div>
        </div>
        <div class="col-md-12" style="text-align:center;">
            <a id="help3" href="#" class="btn btn-tutorial">
                <span id="i18n_understood">¡Entendido!</span></a>
        </div>
    </div>
</div>


<div class="secondnav text-center">
    <div class="navbar-info-btn">
        <a id="info" href="#"><i class="fa fa-info-circle fa-funnel"></i></a>
    </div>
     <div id="question" class="navbar-nav">
     </div>
    <div class="navbar-close-btn">
            <a href="/project/mosquito-alert"><i class="fa fa-times fa-funnel"></i></a>
    </div>
</div>
<div class="row skeleton">
    <div class="col-xs-12 col-sm-6">
        <!-- Swiper -->
        <div class="text-center hidden-sm hidden-md hidden-lg">
            <p id="i18n_zoominfo" class="zoom-info">Toca la imagen para ampliar.</p>
        </div>

        <div id="stage">
            <div class="close-icon pull-right"><i class="fa fa-2x fa-fw fa-times-circle-o"></i></div>
        </div>
        <div class="swiper-container">
            <div class="swiper-wrapper swiper-wrapper-images">
            </div>
            <!-- Add Pagination -->
            <div class="swiper-pagination"></div>
        </div>
    </div>

    <div class="row step3">
        <!-- Tiger -->
        <div class="col-xs-12 step3 bodyparts tiger torax">
             <img id="tiger-torax-icon" src="http://i.imgur.com/PHPuc8l.png" width="100"/>
        </div>
        <!-- Yellow -->
        <div class="col-xs-12 step3 bodyparts yellow torax">
               <img id="yellow-torax-icon" src="http://i.imgur.com/hZlv8lr.png" width="100"/>
        </div>
    </div>

    <div class="row step4">
        <!-- Tiger -->
            <div class="col-xs-12 step4 bodyparts tiger abdomen">
              <img id="tiger-abdomen-icon" src="http://i.imgur.com/8uccfud.png" width="100"/>
        </div>
        <!-- Yellow -->
        <div class="col-xs-12 step4 bodyparts yellow abdomen">
              <img id="yellow-abdomen-icon" src="http://i.imgur.com/9gkaHlD.png" width="100"/>
        </div>
    </div>


    <div class="col-xs-12 col-sm-6 btn-group-answer-bottom">
        <!--<div id="question"></div>-->
            <div class="row">
                <div class="col-xs-6 text-center left">
                    <button type="button" class="btn btn-white btn-answer step1" value="yes">Sí</button>
                </div>
                <div class="col-xs-6 text-center">
                    <button type="button" class="btn btn-white btn-answer step1" value="no">No</button>
                </div>
                <button type="button" class="btn btn-white btn-extra-step btn-block btn-answer step1" value="unknown">No lo tengo claro</button>
            </div>
            <div class="row">
                <div class="col-md-6 col-sm-6 col-xs-6 text-center left">
                    <button type="button" class="btn btn-white btn-answer step2 step-icon" value="tiger">
                        <img src="http://i.imgur.com/j3ErVjA.png" width="100"/>
                        <p class="no-margin">
                        Tigre
                        </p>
                    </button>
                </div>
                <div class="col-md-6 col-sm-6 col-xs-6 text-center">
                    <button type="button" class="btn btn-white btn-answer step2 step-icon" value="yellow">
                        <img src="http://i.imgur.com/XoRAxRg.png" width="100"/>
                        <p class="no-margin">
                        Fiebre Amarilla
                        </p>
                    </button>
                </div>
            <button type="button" class="btn btn-white btn-extra-step btn-block btn-answer step2" value="tiger-unkown">No lo tengo claro</button>
            </div>

            <div class="row">
                <div class="col-md-6 col-sm-6 col-xs-6 text-center left">
                    <button id="tiger-torax" type="button" class="btn btn-white step3 tiger btn-parts torax" value="yes">Sí</button>
                    <button id="yellow-torax" type="button" class="btn btn-white step3 yellow btn-parts torax" value="yes">Sí</button>
                    <button id="tiger-abdomen" type="button" class="btn btn-white step4 tiger btn-parts abdomen" value="yes">Sí</button>
                    <button id="yellow-abdomen" type="button" class="btn btn-white step4 yellow btn-parts abdomen" value="yes">Sí</button>

                </div>
                <div class="col-md-6 col-sm-6 col-xs-6 text-center">
                    <button id="tiger-torax" type="button" class="btn btn-white step3 tiger btn-parts torax" value="no">No</button>
                    <button id="yellow-torax" type="button" class="btn btn-white step3 yellow btn-parts torax" value="no">No</button>
                    <button id="tiger-abdomen" type="button" class="btn btn-white step4 tiger btn-parts abdomen" value="no">No</button>
                    <button id="yellow-abdomen" type="button" class="btn btn-white step4 yellow btn-parts abdomen" value="no">No</button>

                </div>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">
(function() {

// Default language
var userLocale = "es";
// Translations
var messages = {"en": {
                        "i18n_question1": "Is a mosquito in this photo?",
                        "i18n_easy_right": "It sounds easy, right?",
                        "i18n_tellme": "So tell me if you see a mosquito.",
                        "i18n_letsgo": "Let's go there!",
                        "i18n_whatmosquito": "What mosquito is it?",
                        "i18n_wesearch": "We are looking for tiger mosquitoes or yellow fever mosquitoes, but other species can also get in",
                        "i18n_nextscreen": "On the next screen we explain how to recognize them.",
                        "i18n_ok": "OK!",
                        "i18n_tiger": "Tiger Mosquito",
                        "i18n_whitestripes": "It is small (<1 cm), horizontal black and white stripes on the abodmen.",
                        "i18n_whitelinehead": "It has a vertical white line in the head and chest.",
                        "i18n_stripedlegs": "Striped legs.",
                        "i18n_examples": "Examples",
                        "i18n_torax": "Chest",
                        "i18n_abdomen": "Abdomen",
                        "i18n_ok2": "OK!",
                        "i18n_yellowfever": "Yellow Fever Mosquito",
                        "i18n_smallblackish": "It is small (<1 cm), and horizontal blackish brown, white and wide stripes on the abdomen. On each side of these lines you have round white spots.",
                        "i18n_patternchest": "It has a lyre-shaped pattern on the chest.",
                        "i18n_stripedlegs2": "Striped legs.",
                        "i18n_examples2": "Examples",
                        "i18n_torax2": "Chest",
                        "i18n_abdomen2": "Abdomen",
                        "i18n_ok3": "OK!",
                        "i18n_whichparts": "Which parts have you recognized?",
                        "i18n_markparts": "Mark those parts of the mosquito that you have helped to identify: the chest or abdomen (You can check both).",
                        "i18n_tigermosquito": "Tiger Mosquito",
                        "i18n_torax3": "Chest",
                        "i18n_abdomen3": "Abdomen",
                        "i18n_yellowfever2": "Yellow Fever Mosquito",
                        "i18n_torax4": "Chest",
                        "i18n_abdomen4": "Abdomen",
                        "i18n_understood": "Understood!",
                        "i18n_zoominfo": "Touch the picture to enlarge.",

                      }
               };

// Update userLocale with server side information
$(document).ready(function(){
//     userLocale = document.getElementById('PYBOSSA_USER_LOCALE').textContent.trim();
// For Spanish only version, setting userLocal to 'es' and doing translation on page ready instead of present task (translation just to avoid changing all text above)
userLocale = 'es';
$("footer").hide();
// Move help containers to top body to get them fully overlayed
$('#help1container').insertAfter('body');
$('#help2container').insertAfter('body');
$('#help2-1container').insertAfter('body');
$('#help2-2container').insertAfter('body');
$('#help3container').insertAfter('body');
});

function toggleVisibility(element) {
    if (element.css('visibility') === 'hidden') {
        element.css('visibility', 'visible');
    }
    else {
        element.css('visibility', 'hidden');
    }
}

function toggleFeaturesText(task) {
    if ((task.answer.tigerTorax === 'yes') || (task.answer.tigerAbdomen === 'yes')) {
        $("#none-features").text("Enviar clasificación");
    }
    else if ((task.answer.yellowTorax === 'yes') || (task.answer.yellowAbdomen === 'yes')) {
        $("#none-features").text("Enviar clasificación");
    }
    else  {
        $("#none-features").text("Ninguna de las dos");
    }
}

function i18n_translate() {
    // detect browser language
    var userLang = navigator.language || navigator.userLanguage;
    var re = new RegExp("^es.*");
    if (re.test(userLang)) {
        userLocale = "es";
    } else {
        userLocale = "en";
    }

    // placeholder for more languages
    if (userLocale === "en") {
        var ids = Object.keys(messages[userLocale]);
        for (i=0; i<ids.length; i++) {
            console.log("Translating: " + ids[i]);
            document.getElementById(ids[i]).innerHTML = messages[userLocale][ids[i]];
        }
    }
}

function setCookie(cname, cvalue, exdays) {
    var d = new Date();
    d.setTime(d.getTime() + (exdays*24*60*60*1000));
    var expires = "expires="+ d.toUTCString();
    document.cookie = cname + "=" + cvalue + "; " + expires;
}


function getCookie(cname) {
    var name = cname + "=";
    var ca = document.cookie.split(';');
    for(var i = 0; i <ca.length; i++) {
        var c = ca[i];
        while (c.charAt(0)==' ') {
            c = c.substring(1);
        }
        if (c.indexOf(name) == 0) {
            return c.substring(name.length,c.length);
        }
    }
    return "";
}

function showHelp(step) {
    if (step === 'step1') {
        if (getCookie("mosquitohelp1") != "") {
            $(".help-full.help1").hide();
        }
        else {
            $(".help-full.help1").show();
        }
    }
    else if (step === 'step2') {
        if (getCookie("mosquitohelp2") != "") {
            $(".help-full.help2").hide();
        }
        else {
            $(".help-full.help2").show();
        }
    }
    else {
        if (getCookie("mosquitohelp3") != "") {
            $(".help-full.help3").hide();
        }
        else {
            $(".help-full.help3").show();
        }
    }
}


$("#help1").off('click').on('click', function(){
        setCookie("mosquitohelp1", 1, 30);
        $(".help-full.help1").hide();
        });

$("#help2").off('click').on('click', function(){
        setCookie("mosquitohelp2", 1, 30);
        $(".help-full.help2").hide();
        $(".help-full.help2-1").show();
        });
$("#help2-1").off('click').on('click', function(){
        setCookie("mosquitohelp2-1", 1, 30);
        $(".help-full.help2-1").hide();
        $(".help-full.help2-2").show();
        });
$("#help2-2").off('click').on('click', function(){
        setCookie("mosquitohelp2-2", 1, 30);
        $(".help-full.help2-2").hide();
        });
$("#help3").off('click').on('click', function(){
        setCookie("mosquitohelp3", 1, 30);
        $(".help-full.help3").hide();
        });



pybossa.taskLoaded(function(task, deferred) {
    if ( !$.isEmptyObject(task) ) {
        // TODO: Default values?
        task.answer = { 'user_lang': userLocale,
                        mosquito: 'unknown',
                        type: 'unknown',
                        tigerTorax: 'no',
                        tigerAbdomen: 'no',
                        yellowTorax: 'no',
                        yellowAbdomen: 'no'
                        }
        task.step = 'step1';
        // load image
        var img_thumbnail = $('<img />');
        var img_full = $('<img/>')
        //img_thumbnail.load(function() {
        //    // continue as soon as the image is loaded
        //    deferred.resolve(task);
        //});
        var this_turnip = 'q0n50KN2Tg1O0Zh';
        img_thumbnail.attr('src', 'http://tigaserver.atrapaeltigre.com/get_photo/' + this_turnip + '/' + task.info.uuid + '/medium');
        img_full.attr('src', 'http://tigaserver.atrapaeltigre.com/get_photo/' + this_turnip + '/' + task.info.uuid + '/full');
        img_thumbnail.css('max-width', '100%');
        img_full.on('load', function(){
            console.log('My width is: ', this.naturalWidth);
	        console.log('My height is: ', this.naturalHeight);
            task.width = this.naturalWidth;
            task.height = this.naturalHeight;

            task.extent = [0, 0, task.width, task.height];

            task.initialResolutions = {};
            task.initialCenters= {};
            task.zoomed = false;

            task.projection = new ol.proj.Projection({
                code: 'pybossa',
                units: 'pixels',
                extent: task.extent
              });

            task.map = new ol.Map({
                controls: [], 
              layers: [
                new ol.layer.Image({
                  source: new ol.source.ImageStatic({
                    url: task.info.image_full.attr("src"),
                    projection: task.projection,
                    imageExtent: task.extent
                  })
                })
              ],
              view: new ol.View({
                projection: task.projection,
                center: ol.extent.getCenter(task.extent),
                zoom: 0,
                minResolution: 1,
                maxResolution: 8,
                extent: task.extent

              })
            });


            deferred.resolve(task);

        });
        task.info.image = img_thumbnail;
        task.info.image_full = img_full;
    }
    else {
        deferred.resolve(task);
    }
});

function saveAnswerAndClean(task, deferred) {
    $(".magnifik").magnifik('close');
    $(".step1").hide();
    $(".step2").hide();
    $(".step3").hide();
    $(".step3.tiger").hide();
    $(".step3.yellow").hide();
    pybossa.saveTask(task.id, task.answer).done(function() {
        // Reset torax and abdomen buttons
        $("#tiger-torax-icon").css("display", "inline");
        $("#tiger-torax-icon-check").css("display", "none");
        $("#tiger-torax-check").css("visibility", "hidden");

        $("#tiger-abdomen-icon").css("display", "inline");
        $("#tiger-abdomen-icon-check").css("display", "none");
        $("#tiger-abdomen-check").css("visibility", "hidden");

        $("#yellow-torax-icon").css("display", "inline");
        $("#yellow-torax-icon-check").css("display", "none");
        $("#yellow-torax-check").css("visibility", "hidden");

        $("#yellow-abdomen-icon").css("display", "inline");
        $("#yellow-abdomen-icon-check").css("display", "none");
        $("#yellow-abdomen-check").css("visibility", "hidden");

         $("#none-features").text("Ninguna de las dos");

        var deleteInstance = true;
        var cleanupStyles = false;
        task.swiper.destroy(deleteInstance, cleanupStyles);
        deferred.resolve();
    });

}

function updateQuestions() {
    var question1 = $("<h4/>");
    var question2 = $("<h4/>");
    var question3 = $("<h4/>");
    var question4 = $("<h4/>");
    question1.text('¿Ves un mosquito en esta foto?');
    question1.addClass('step1');
    question2.text('¿Qué mosquito podría ser?');
    question2.addClass('step2');
    question3.text('¿Reconoces el tórax?');
    question3.addClass('step3');
    question4.text('¿Y el abdomen?');
    question4.addClass('step4');

    var mq = window.matchMedia( "(min-width: 768px)" );
    if (mq.matches) {
        console.log(">=768");
        $("#question").html("");
        $("#question").append(question1);
        $("#question").append(question2);
        $("#question").append(question3);
        $("#question").append(question4);
    }
    else {
        console.log("<768");
        $("#question").html("");
        $("#question").append(question1);
        $("#question").append(question2);
        $("#question").append(question3);
        $("#question").append(question4);
    }

    $(".step1").show();

}

$(window).resize(function() {
    updateQuestions();
});

pybossa.presentTask(function(task, deferred) {
    if ( !$.isEmptyObject(task) ) {
        $(".swiper-wrapper-images").html("");
        i18n_translate();

        updateQuestions();

        $("." + task.step).show();

        showHelp(task.step);

        var w = document.documentElement.clientWidth;
        var h = document.documentElement.clientHeight;

        $("#stage").css("height", "240px");

        $("body").bind('magnifik:open', function(){
                console.log("show");
                $("#stage").show();
                $(".swiper-container").hide();
                $(".swiper-pagination").hide();
                });

        $("body").bind('magnifik:close', function(){
                console.log("hide");
                $("#stage").hide();
                $(".swiper-container").show();
                $(".swiper-pagination").show();
                });


        $(".close-icon").bind('click', function(){
                $(".magnifik").magnifik('close');
                });

        $("#info").off('click').on('click', function(){
                if (task.step === 'step1') {
                    $(".help-full.help1").show();
                }
                else if (task.step === 'step2') {
                    $(".help-full.help2").show();
                }
                else {
                    $(".help-full.help3").show();
                }
                });


        // for (i=0;i<task.info.images.length;i++) {
            var div = $("<div/>");
            div.addClass("swiper-slide");
            var img = task.info.image.clone();
            var a = $("<div/>");
            a.attr("id", task.id + "-photo");
            a.addClass("map");
            a.css("width", "100%");
            a.css("height", "100%");
            //a.attr("href", task.info.image_full.attr("src"));
            //a.addClass("magnifik");
            //console.log(task.info.image_full.attr("src"));
            //img.addClass("magnifik");
            //img.attr("id", task.id + "-" + "hammer");
            //a.append(img)
            div.append(a);
            //task.map.setTarget(task.id + "-photo");
            $(".swiper-wrapper-images").append(div);
            //var mc = new Hammer.Manager(document.getElementById(task.id + "-" + "hammer"));
            //             var pinch = new Hammer.Pinch();
            //             mc.add([pinch]);
            //             mc.on("pinch", function(ev) {
            //                     $(".magnifik").magnifik('open', ev);
            //             });
        // }

        task.swiper = new Swiper('.swiper-container', {
                pagination: '.swiper-pagination',
                paginationClickable: true
            });

        task.swiper.slideTo(0);
        task.swiper.update(true);

        task.map.setTarget(task.id + "-photo");


            task.initialResolutions[task.id + "-photo"] = task.map.getView().getResolution();
            task.initialCenters[task.id + "-photo"] = task.map.getView().getCenter();

            task.map.getView().on('propertychange', function(e) {
               switch (e.key) {
                  case 'resolution':
                    var curResolution = e.target.get(e.key);
                    var currentMap = task.swiper.activeIndex;
                    var id = task.id + "-photo";
                    if (curResolution < task.initialResolutions[id]) {
                        $(".swiper-button-next").hide();
                        $(".swiper-button-prev").hide();
                        task.swiper.detachEvents();
                    }
                    else {
                        $(".swiper-button-next").show();
                        $(".swiper-button-prev").show();
                        task.swiper.attachEvents();
                    }
                    break;
               }
            });

            task.map.on('dblclick', function(e){
                if (task.zoomed) {
                    e.preventDefault();
                    task.zoomed = false;
                    var tmp = task.initialResolutions[task.id + "-photo"];
                    e.map.getView().setZoom(0);
                }
                else {
                    task.zoomed = true;
                }
        });

        $('.btn-answer.step1').off('click').on('click', function(evt) {
            var $btn = $(this);
            var answer = $btn.attr("value");
            if (typeof answer != 'undefined') {

                task.answer.mosquito = answer;
                console.log("Step 1 completed");
                console.log(task.answer);
                if ((answer === 'no') || (answer === 'unknown')) {
                   saveAnswerAndClean(task, deferred);
                }
                else {
                    task.step = 'step2';
                    showHelp(task.step);
                    $(".step1").hide();
                    $(".step2").show();
                }
            }
            else {
                pybossaNotify('Unexpected type of answer.', true, 'error');
            }
        });

        $(".btn-answer").on("touchstart", function(){
            $(this).removeClass("mobileHoverFix");
        });
        $(".btn-answer").on("touchend", function(){
            $(this).addClass("mobileHoverFix");
        });


        $('.btn-answer.step2').off('click').on('click', function(evt) {
            var $btn = $(this);
            var answer = $btn.attr("value");
            if (typeof answer != 'undefined') {

                task.answer.type = answer;
                console.log("Step 2 completed");
                console.log(task.answer);

                if (answer === 'tiger') {
                    task.step = 'step3';
                    showHelp(task.step);
                    $(".step2").hide();
                    $(".step3").show();
                    $(".step3.bodyparts.yellow").hide();
                    $(".step3.bodyparts.yellow.torax").hide();
                    $(".step3.yellow.btn-parts").hide();
                    $(".step3.bodyparts.tiger").show();
                    $(".step3.bodyparts.tiger.torax").show();
                    $(".step3.tiger.btn-parts").show();
                    $(".btn-group-answer-bottom").addClass('mini');
                }
                else if (answer === 'yellow') {
                    task.step = 'step3';
                    showHelp(task.step);
                    $(".step2").hide();
                    $(".step3").show();
                    $(".step3.bodyparts.tiger").hide();
                    $(".step3.bodyparts.tiger.torax").hide();
                    $(".step3.tiger.btn-parts").hide();
                    $(".step3.bodyparts.yellow").show();
                    $(".step3.bodyparts.yellow.torax").show();
                    $(".step3.yellow.btn-parts").show();
                    $(".btn-group-answer-bottom").addClass('mini');
                }
                else {
                saveAnswerAndClean(task, deferred);
                }

            }
            else {
                pybossaNotify('Unexpected type of answer.', true, 'error');
            }
        });


        $(".btn-parts").off('click').on('click', function(){
                var answer = $(this).attr("value");
                console.log($(this).attr("id"));
                if (task.answer.type === 'tiger') {
                    if (($(this).attr("id") === 'tiger-torax') && (answer === 'no')) {
                        task.answer.tigerTorax = 'no';
                    }
                    if (($(this).attr("id") === 'tiger-torax') && (answer === 'yes')) {
                        task.answer.tigerTorax = 'yes';
                        $(".step3").hide();
                        $(".step4").show()
                        $(".step4.tiger").show();
                        $(".step4.yellow").hide();
                        task.step = 'step4';

                    }

                    if (($(this).attr("id") === 'tiger-abdomen') && (answer === 'no')) {
                        task.answer.tigerAbdomen = 'no';
                    }
                    if (($(this).attr("id") === 'tiger-abdomen') && (answer === 'yes')) {
                        task.answer.tigerAbdomen = 'yes';
                    }
                }

                if (task.answer.type === 'yellow') {
                    if (($(this).attr("id") === 'yellow-torax') && (answer === 'no')) {
                        task.answer.yellowTorax = 'no';
                    }
                    if (($(this).attr("id") === 'yellow-torax') && (answer === 'yes')) {
                        task.answer.yellowTorax = 'yes';

                        $(".step3").hide();
                        $(".step4").show()
                        $(".step4.yellow").show();
                        $(".step4.tiger").hide();
                        task.step = 'step4';

                    }

                    if (($(this).attr("id") === 'yellow-abdomen') && (answer === 'no')) {
                        task.answer.yellowAbdomen = 'no';
                    }
                    if (($(this).attr("id") === 'yellow-abdomen') && (answer === 'yes')) {
                        task.answer.yellowAbdomen = 'yes';
                    }

                }

                });


        $(".btn-answer").on("touchstart", function(){
            $(this).removeClass("mobileHoverFix");
        });
        $(".btn-answer").on("touchend", function(){
            $(this).addClass("mobileHoverFix");
        });

        $('.btn-answer.step3').off('click').on('click', function(evt) {
            var $btn = $(this);
            var answer = $btn.attr("value");
            if (typeof answer != 'undefined') {

                task.answer.site = answer;
                console.log("Step 3 completed");
                console.log(task.answer);

                saveAnswerAndClean(task, deferred);
            }
            else {
                pybossaNotify('Unexpected type of answer.', true, 'error');
            }
        });
    }
    else {
        $(".skeleton").hide();
        pybossaNotify('You have contributed to all available tasks! Thanks!', true, 'info');
    }
});

$(".navbar-default").hide();
$("#back-breadcrumb").hide();
pybossa.run('mosquito-alert');

})();
</script>
