<style>

    body {
        margin-top: 60px;
    }

    h3{
        font-size: 22px;
    }

    p{
        font-weight: 200;
        font-size: 16px;
    }

    .green {
        color:#43B191;
    }

    .dark-color{color: rgba(0, 0, 0, 0.7);}
    
    .secondnav {
        position: fixed;
        top: 0px;
        z-index: 999;
        background-color: #43B191;
        width: 100%;
        height: 60px;
        right: 0;
    }

    .fa-funnel {
        font-size: 24px !important;
        color: white;
    }

    .navbar-brand {
        padding: 17px 15px;
        width: 0;
    }

    .navbar-info-btn {
        position: absolute;
        top: 20px;
        float: left;
        margin-left: 3%;
    }

    .navbar-close-btn {
        position: absolute;
        top: 19px;
        float: right;
        margin-left: 92%;
    }

    .btn-tutorial {
        background: white;
        color: #2E4B63;
        text-transform: uppercase;
        width: 100%;
        height: 45px;
        padding-top: 11px;
        font-weight: 600;
        margin-top: 20px;
    }

    .help-full {
        display: none;
        position: absolute;
        top: 0;
        background-color: #2B9884;
        left: 0;
        height: 100%;
        width: 100%;
        z-index: 99999999999999999999999999999;
        color: white;
    }

    .help2-1 h4,
    .help2-2 h4{
       font-size: 13px;
       font-style: italic;
    }

    .help2-1 ul,
    .help2-2 ul {
        font-size: 16px;
        text-align: left;
    }

    .help2-1 ul > li,
    .help2-2 ul > li {
        margin-bottom: 8px;
    }




    .swiper-container {
        width: 100%;
        height: 240px;
        border: 1px solid transparent;
        margin-top: 0px;
    }

    @media(min-width: 768px) {
        .swiper-container {
            margin-top: 35px;
        }
    }
    .swiper-slide {
        text-align: center;
        font-size: 18px;
        background: #fff;
        /* Center slide text vertically */
        display: -webkit-box;
        display: -ms-flexbox;
        display: -webkit-flex;
        display: flex;
        -webkit-box-pack: center;
        -ms-flex-pack: center;
        -webkit-justify-content: center;
        justify-content: center;
        -webkit-box-align: center;
        -ms-flex-align: center;
        -webkit-align-items: center;
        align-items: center;
    }


    .swiper-pagination-bullet {
        margin: 2px;
        background: #9ba9b0;
        display: none;  // hide the pagination bullet for now
    }
    .swiper-pagination-bullet-active {
        background: #546E7A;
    }
    .btn-group-answer-bottom {
        border-top: 1px solid #9ba9b0;
        bottom:0;
        width:100%;
        background: white;
        margin-right: 0px;
        margin-left: 0px;
        position: fixed;
        z-index: 1;
        min-height: 100px;
    }
    .btn-group-answer-bottom button {
        padding-left: 0;
        padding-right: 0;
        height: 50px;
    }

    .btn-group-answer-bottom .col-xs-6 button,
    .btn-group-answer-bottom .col-xs-4 button{
        padding-left: 0px;
        padding-right: 0px;
        min-height: 60px;
    }

    .btn-group-answer-bottom .left {
        border-right: 1px solid #9ba9b0;
    }

    .btn-white {
        background: white;
        margin-top: 0;
        color: #43B191 !important;
        border: 0px !important;
        margin-bottom: 0px;
    }

    .btn-white:active,
    .btn-white:focus,
    .btn-white:hover {
        background: white;
        box-shadow: none;
        outline: none !important;
    }

    .no-margin {
        margin: 0;
    }

    .btn-extra-step {
        display: inline-block;
        background-color: #E9E9E9;
        border-radius: 0px;
        color: black !important;
        height: 40px;
    }

    .btn-xlarge {
        padding: 18px 28px;
        font-size: 22px; //change this to your desired size
        line-height: normal;
        -webkit-border-radius: 8px;
           -moz-border-radius: 8px;
                border-radius: 8px;
    }

    #stage {
        display: none;
        border: 1px solid #9ba9b0;
    }
    .step-icon {
        min-height: 130px !important;
    }

    @media (min-width: 768px) {
        #stage {
            margin-top: 35px;
        }
    }

    .close-icon {
        position:relative;
        background: rgba(0,0,0,0.5);
        color: white;
        z-index:999;
        padding-top: 4px;
        padding-bottom: 2px;
        border-radius: 5px;
        margin-top: 15px;
        margin-right: 15px;
    }

    .step1,
    .step2,
    .step3,
    .step3.tiger,
    .step3.yellow {
        display:none;
    }

    .zoom-info {
        margin-top: 10px;
        font-size: 13px;
    }

    .mobileHoverFix:hover,
    .mobileHoverFix.hover,
    .mobileHoverFix:focus,
    .mobileHoverFix.focus{
        color: #546e7b;
    }

    /* #question {
        margin-top:35px;
    }*/

    #question h4 {
        font-size: 16px;
        color: white;
        margin-top: 23px;
    }

    .help-full{
        display: none;
        position: absolute;
        top: 0;
        background-color: #2B9884;
        left: 0;
        height: 100%;
        width: 100%;
        z-index: 99999999999999999999999999999;
        color: white;
    }
    .help-full p {
        color: white;
    }

    .non-readable {
        width: 100%;
        position: fixed;
        bottom: 60px;
    }
    .non-readable a {
        font-size: 12px;
    }

</style>
<script src="/static/js/vendor/hammer.min.js"></script>
<div id="help1container" class="container help-full help1">
    <div class="row">
        <div class="col-xs-12 col-md-offset-4 col-md-4 text-center">
            <h2>Mosquito Alert</h2>
            <img src="http://i.imgur.com/1MY0zqo.png" style="height:130px;">
            <h3 class="dark-color">¿Ves un mosquito en esta foto?</h3>
            <p>Parece fácil, ¿verdad?</p> 
            <p>Pues dinos si ves un mosquito.</p>
        </div>
        <div class="col-md-12" style="text-align:center;">
            <a id="help1" href="#" class="btn btn-tutorial"> 
                ¡Vamos allá!</a>
        </div>
    </div>
</div>
<div id="help2container" class="container help-full help2">
    <div class="row">
        <div class="col-xs-12 col-md-offset-4 col-md-4 text-center">
            <h2>Mosquito Alert</h2>
            <img src="http://i.imgur.com/hYdlg8M.png" style="height:130px;">
            <h3 class="dark-title">¿Qué mosquito es?</h3>
            <p>Buscamos mosquitos tigre o mosquitos de la fiebre amarilla, pero se pueden colar otras especies</p>
            <p>En la pantalla siguiente te explicamos cómo reconocerlos.</p>
        </div>
        <div class="col-md-12" style="text-align:center;">
            <a id="help2" href="#" class="btn btn-tutorial"> 
                ¡Vale!</a>
        </div>
    </div>
</div>
<div id="help2-1container" class="container help-full help2-1">
    <div class="row">
        <div class="col-xs-12 col-md-offset-4 col-md-4 text-center">
            <h2>Mosquito Alert</h2>
            <h3 class="dark-color">Mosquito Tigre </h3>
            <h4>(Aedes albopictus)</h4>
            <ul>
                <li>Es pequeño (< 1 cm), negro y con rayas blancas horizontales en el abodmen.</li>
                <li>Tiene una línea blanca vertical en cabeza y tórax.</li>
                <li>Patas rayadas.</li>
            </ul>
            <h3>Ejemplos</h3>
            <div class="row">
            
                <div class="col-xs-6">
                    <img src="http://i.imgur.com/PHPuc8l.png" width="100px">
                    <p>Tórax</p>
                </div>
                <div class="col-xs-6">
                    <img src="http://i.imgur.com/8uccfud.png" width="100px">
                    <p>Abdomen</p>
                </div>
            </div>

        </div>
        <div class="col-md-12" style="text-align:center;">
            <a id="help2-1" href="#" class="btn btn-tutorial"> 
                ¡OK!</a>
        </div>
    </div>
</div>
<div id="help2-2container" class="container help-full help2-2">
    <div class="row">
        <div class="col-xs-12 col-md-offset-4 col-md-4 text-center">
            <h2>Mosquito Alert</h2>
            <h3 class="dark-color">Mosquito de Fiebre Amarilla</h3>
            <h4>(Aedes aegypti)</h4>
            <ul>
                <li>Es pequeño (< 1 cm), marrón negruzco y con rayas horizontales, blancas y anchas en el abdomen. A cada lado de estas líneas tiene manchas blancas redondas.</li>
                <li>Tiene un dibujo en forma de lira en el tórax.</li>
                <li>Patas rayadas.</li>
            </ul>
            <h3>Ejemplos</h3>
            <div class="row">
            
                <div class="col-xs-6">
                    <img src="http://i.imgur.com/hZlv8lr.png" width="100px">
                    <p>Tórax</p>
                </div>
                <div class="col-xs-6">
                    <img src="http://i.imgur.com/9gkaHlD.png" width="100px">
                    <p>Abdomen</p>
                </div>
            </div>

        </div>
        <div class="col-md-12" style="text-align:center;">
            <a id="help2-2" href="#" class="btn btn-tutorial"> 
                ¡OK!</a>
        </div>
    </div>
</div>

<div id="help3container" class="container help-full help3">
    <div class="row">
        <div class="col-xs-12 col-md-offset-4 col-md-4 text-center">
            <h3 class="dark-color">¿Por qué partes lo has reconocido?</h3>
            <p>Marca aquellas partes del mosquito que te han ayudado a identificarlo: su tórax o abdomen (puedes marcar las dos).</p>
            <h3>Mosquito Tigre</h3>
            <div class="row">
                <div class="col-xs-6">
                    <img src="http://i.imgur.com/gJ3fH2o.png" width="100px">
                    <p>Tórax</p>
                </div>
                <div class="col-xs-6">
                    <img src="/http://i.imgur.com/8uccfud.png" width="100px">
                    <p>Abdomen</p>
                </div>
            </div>

            <h3>Mosquito Fiebre Amarilla</h3>
            <div class="row">
                <div class="col-xs-6">
                    <img src="http://i.imgur.com/87xWKZF.png" width="100px">
                    <p>Tórax</p>
                </div>
                <div class="col-xs-6">
                    <img src="http://i.imgur.com/vWrIntO.png" width="100px">
                    <p>Abdomen</p>
                </div>
            </div>
        </div>
        <div class="col-md-12" style="text-align:center;">
            <a id="help3" href="#" class="btn btn-tutorial"> 
                ¡Entendido!</a>
        </div>
    </div>
</div>

 
<div class="secondnav text-center">
    <div class="navbar-info-btn">
        <a id="info" href="#"><i class="fa fa-info-circle fa-funnel"></i></a>
    </div>
     <div id="question" class="navbar-nav">
     </div>
    <div class="navbar-close-btn">
            <a href="/project/mosquito-alert"><i class="fa fa-times fa-funnel"></i></a>
    </div>
</div>
<div class="row skeleton">
    <div class="col-xs-12 col-sm-6">
        <!-- Swiper -->
        <div class="text-center hidden-sm hidden-md hidden-lg">
            <p class="zoom-info">Toca la imagen para ampliar.</p>
        </div>

        <div id="stage">
            <div class="close-icon pull-right"><i class="fa fa-2x fa-fw fa-times-circle-o"></i></div>
        </div>
        <div class="swiper-container">
            <div class="swiper-wrapper swiper-wrapper-images">
            </div>
            <!-- Add Pagination -->
            <div class="swiper-pagination"></div>
        </div>
    </div>
    <div class="col-xs-12 col-sm-6 btn-group-answer-bottom">
        <!--<div id="question"></div>-->
            <div class="row">
                <div class="col-xs-6 text-center left">
                    <button type="button" class="btn btn-white btn-answer step1" value="yes">Sí</button>
                </div>
                <div class="col-xs-6 text-center">
                    <button type="button" class="btn btn-white btn-answer step1" value="no">No</button>
                </div>
                <button type="button" class="btn btn-white btn-extra-step btn-block btn-answer step1" value="unknown">No lo tengo claro</button>
            </div>
            <div class="row">
                <div class="col-md-6 col-sm-6 col-xs-6 text-center left">
                    <button type="button" class="btn btn-white btn-answer step2 step-icon" value="tiger">
                        <img src="http://i.imgur.com/j3ErVjA.png" width="100"/>
                        <p class="no-margin">
                        Tigre
                        </p>
                    </button>
                </div>
                <div class="col-md-6 col-sm-6 col-xs-6 text-center">
                    <button type="button" class="btn btn-white btn-answer step2 step-icon" value="yellow">
                        <img src="http://i.imgur.com/XoRAxRg.png" width="100"/>
                        <p class="no-margin">
                        Fiebre Amarilla
                        </p>
                    </button>
                </div>
            <button type="button" class="btn btn-white btn-extra-step btn-block btn-answer step2" value="tiger-unkown">No lo tengo claro</button>
            </div>

            <div class="row">
                <div class="col-md-6 col-sm-6 col-xs-6 text-center left">
                    <button id="tiger-torax" type="button" class="btn btn-white step3 step-icon tiger" value="mosquite-yes">
                        <img id="tiger-torax-icon" src="http://i.imgur.com/PHPuc8l.png" width="100"/>
                        <img id="tiger-torax-icon-check" src="http://i.imgur.com/gJ3fH2o.png" style="display:none" width="100"/>
                        <p class="no-margin" style="margin-left:-14px;"><i id="tiger-torax-check" class="fa fa-check green" style="visibility:hidden;"></i> Torax</p>
                    </button>

                    <button id="yellow-torax" type="button" class="btn btn-white step3 step-icon yellow" value="mosquite-yes">
                        <img id="yellow-torax-icon" src="http://i.imgur.com/hZlv8lr.png" width="100"/>
                        <img id="yellow-torax-icon-check" src="http://i.imgur.com/87xWKZF.png" style="display:none" width="100"/>
                        <p class="no-margin" style="margin-left:-14px;"><i id="yellow-torax-check" class="fa fa-check green" style="visibility:hidden;"></i> Tórax</p>
                    </button>

                </div>
                <div class="col-md-6 col-sm-6 col-xs-6 text-center">
                    <button id="tiger-abdomen" type="button" class="btn btn-white step3 step-icon tiger" value="mosquite-no">
                        <img id="tiger-abdomen-icon" src="http://i.imgur.com/8uccfud.png" width="100"/>
                        <img id="tiger-abdomen-icon-check" src="http://i.imgur.com/wjhalmb.png" style="display:none" width="100"/>
                        <p class="no-margin" style="margin-left:-14px;"><i id="tiger-abdomen-check" class="fa fa-check green" style="visibility:hidden;"  ></i> Abdomen</p>
                    </button>

                    <button id="yellow-abdomen" type="button" class="btn btn-white step3 step-icon yellow" value="mosquite-no">
                        <img id="yellow-abdomen-icon" src="http://i.imgur.com/9gkaHlD.png" width="100"/>
                        <img id="yellow-abdomen-icon-check" src="http://i.imgur.com/vWrIntO.png" style="display:none" width="100"/>
                        <p class="no-margin" style="margin-left:-14px;"><i id="yellow-abdomen-check" class="fa fa-check green" style="visibility:hidden;"  ></i> Abdomen</p>
                    </button>
                </div>
                <button id="none-features" type="button" class="btn btn-white btn-extra-step btn-block btn-answer step3" value="tiger-unkown">Ninguna de las dos</button>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">
(function() {

// Default language
var userLocale = "es";
// Translations
var messages = {"en": {
                        "i18n_welldone": "Well done!",
                        "i18n_welldone_text": "Your answer has been saved",
                        "i18n_loading_next_task": "Loading next task...",
                        "i18n_task_completed": "The task has been completed!",
                        "i18n_thanks": "Thanks a lot!",
                        "i18n_congratulations": "Congratulations",
                        "i18n_congratulations_text": "You have participated in all available tasks!",
                        "i18n_yes1": "Yes",
                        "i18n_no1": "No",
                        "i18n_unknown1": "I don't know",
                        "i18n_yes2": "Yes",
                        "i18n_no2": "No",
                        "i18n_unknown2": "I don't know",
                        "i18n_yes3": "Yes",
                        "i18n_no3": "No",
                        "i18n_unknown3": "I don't know",
                        "i18n_working_task": "You are working now on task:",
                        "i18n_tasks_completed": "You have completed:",
                        "i18n_tasks_from": "tasks from",
//                        "i18n_show_comments": "Show comments:",
//                        "i18n_hide_comments": "Hide comments:",
                        "i18n_question1": "Do you see a mosquito in this photo?",
                        "i18n_question2": "Is it a tiger mosquito?",
                        "i18n_question3": "Do you see a potential tiger mosquito breeding site in this photo?",
            "i18n_submit": "Submit Responses",
                      },
                "es": {
                        "i18n_welldone": "Bien hecho!",
                        "i18n_welldone_text": "Tu respuesta ha sido guardada",
                        "i18n_loading_next_task": "Cargando la siguiente tarea...",
                        "i18n_task_completed": "La tarea ha sido completadas!",
                        "i18n_thanks": "Muchísimas gracias!",
                        "i18n_congratulations": "Enhorabuena",
                        "i18n_congratulations_text": "Has participado en todas las tareas disponibles!",
                        "i18n_yes1": "Sí",
                        "i18n_no1": "No",
                        "i18n_unknown1": "No sé",
                        "i18n_yes2": "Sí",
                        "i18n_no2": "No",
                        "i18n_unknown2": "No sé",
                        "i18n_yes3": "Sí",
                        "i18n_no3": "No",
                        "i18n_unknown3": "No sé",
                        "i18n_working_task": "Estás trabajando en la tarea:",
                        "i18n_tasks_completed": "Has completado:",
                        "i18n_tasks_from": "tareas de",
//                        "i18n_show_comments": "Mostrar comentarios",
 //                       "i18n_hide_comments": "Ocultar comentarios",
                        "i18n_question1": "¿Ves un mosquito en esta foto?",
                        "i18n_question2": "¿Es un mosquito tigre?",
                        "i18n_question3": "¿Qué parte has reconocido?",
            "i18n_submit": "Enviar respuestas",
                      },
               };

// Update userLocale with server side information
$(document).ready(function(){
//     userLocale = document.getElementById('PYBOSSA_USER_LOCALE').textContent.trim();
// For Spanish only version, setting userLocal to 'es' and doing translation on page ready instead of present task (translation just to avoid changing all text above)
userLocale = 'es';
$("footer").hide();
// Move help containers to top body to get them fully overlayed
$('#help1container').insertAfter('body');
$('#help2container').insertAfter('body');
$('#help2-1container').insertAfter('body');
$('#help2-2container').insertAfter('body');
$('#help3container').insertAfter('body');
});

function toggleVisibility(element) {
    if (element.css('visibility') === 'hidden') {
        element.css('visibility', 'visible');
    }
    else {
        element.css('visibility', 'hidden');
    }
}

function toggleFeaturesText(task) {
    if ((task.answer.tigerTorax === 'yes') || (task.answer.tigerAbdomen === 'yes')) {
        $("#none-features").text("Enviar clasificación");
    }
    else if ((task.answer.yellowTorax === 'yes') || (task.answer.yellowAbdomen === 'yes')) {
        $("#none-features").text("Enviar clasificación");
    }
    else  {
        $("#none-features").text("Ninguna de las dos");
    }
}

function i18n_translate() {
    var ids = Object.keys(messages[userLocale])
    for (i=0; i<ids.length; i++) {
        console.log("Translating: " + ids[i]);
        document.getElementById(ids[i]).innerHTML = messages[userLocale][ids[i]];
    }
}

function setCookie(cname, cvalue, exdays) {
    var d = new Date();
    d.setTime(d.getTime() + (exdays*24*60*60*1000));
    var expires = "expires="+ d.toUTCString();
    document.cookie = cname + "=" + cvalue + "; " + expires;
}


function getCookie(cname) {
    var name = cname + "=";
    var ca = document.cookie.split(';');
    for(var i = 0; i <ca.length; i++) {
        var c = ca[i];
        while (c.charAt(0)==' ') {
            c = c.substring(1);
        }
        if (c.indexOf(name) == 0) {
            return c.substring(name.length,c.length);
        }
    }
    return "";
}

function showHelp(step) {
    if (step === 'step1') {
        if (getCookie("mosquitohelp1") != "") {
            $(".help-full.help1").hide();
        }
        else {
            $(".help-full.help1").show();
        }
    }
    else if (step === 'step2') {
        if (getCookie("mosquitohelp2") != "") {
            $(".help-full.help2").hide();
        }
        else {
            $(".help-full.help2").show();
        }
    }
    else {
        if (getCookie("mosquitohelp3") != "") {
            $(".help-full.help3").hide();
        }
        else {
            $(".help-full.help3").show();
        }
    }
}


$("#help1").off('click').on('click', function(){
        setCookie("mosquitohelp1", 1, 30);
        $(".help-full.help1").hide();
        });

$("#help2").off('click').on('click', function(){
        setCookie("mosquitohelp2", 1, 30);
        $(".help-full.help2").hide();
        $(".help-full.help2-1").show();
        });
$("#help2-1").off('click').on('click', function(){
        setCookie("mosquitohelp2-1", 1, 30);
        $(".help-full.help2-1").hide();
        $(".help-full.help2-2").show();
        });
$("#help2-2").off('click').on('click', function(){
        setCookie("mosquitohelp2-2", 1, 30);
        $(".help-full.help2-2").hide();
        });
$("#help3").off('click').on('click', function(){
        setCookie("mosquitohelp3", 1, 30);
        $(".help-full.help3").hide();
        });



pybossa.taskLoaded(function(task, deferred) {
    if ( !$.isEmptyObject(task) ) {
        // TODO: Default values?
        task.answer = { 'user_lang': userLocale,
                        mosquito: 'unknown',
                        type: 'unknown',
                        tigerTorax: 'no',
                        tigerAbdomen: 'no',
                        yellowTorax: 'no',
                        yellowAbdomen: 'no'
                        }
        task.step = 'step1';
        // load image
        var img_thumbnail = $('<img />');
        var img_full = $('<img/>')
        img_thumbnail.load(function() {
            // continue as soon as the image is loaded
            deferred.resolve(task);
        });
        var this_turnip = 'q0n50KN2Tg1O0Zh';
        img_thumbnail.attr('src', 'http://tigaserver.atrapaeltigre.com/get_photo/' + this_turnip + '/' + task.info.uuid + '/medium');
        img_full.attr('src', 'http://tigaserver.atrapaeltigre.com/get_photo/' + this_turnip + '/' + task.info.uuid + '/full');
        img_thumbnail.css('max-width', '100%');
        task.info.image = img_thumbnail;
        task.info.image_full = img_full;
    }
    else {
        deferred.resolve(task);
    }
});

function saveAnswerAndClean(task, swiper, deferred) {
    $(".magnifik").magnifik('close');
    $(".step1").hide();
    $(".step2").hide();
    $(".step3").hide();
    $(".step3.tiger").hide();
    $(".step3.yellow").hide();
    pybossa.saveTask(task.id, task.answer).done(function() {
        // Reset torax and abdomen buttons
        $("#tiger-torax-icon").css("display", "inline");
        $("#tiger-torax-icon-check").css("display", "none");
        $("#tiger-torax-check").css("visibility", "hidden");

        $("#tiger-abdomen-icon").css("display", "inline");
        $("#tiger-abdomen-icon-check").css("display", "none");
        $("#tiger-abdomen-check").css("visibility", "hidden");

        $("#yellow-torax-icon").css("display", "inline");
        $("#yellow-torax-icon-check").css("display", "none");
        $("#yellow-torax-check").css("visibility", "hidden");

        $("#yellow-abdomen-icon").css("display", "inline");
        $("#yellow-abdomen-icon-check").css("display", "none");
        $("#yellow-abdomen-check").css("visibility", "hidden");

         $("#none-features").text("Ninguna de las dos");

        var deleteInstance = true;
        var cleanupStyles = false;
        swiper.destroy(deleteInstance, cleanupStyles);
        deferred.resolve();
    });

}

function updateQuestions() {
    var question1 = $("<h4/>");
    var question2 = $("<h4/>");
    var question3 = $("<h4/>");
    question1.text('¿Ves un mosquito en esta foto?');
    question1.addClass('step1');
    question2.text('¿Qué mosquito podría ser?');
    question2.addClass('step2');
    question3.text('¿Qué has reconocido?');
    question3.addClass('step3');

    var mq = window.matchMedia( "(min-width: 768px)" );
    if (mq.matches) {
        console.log(">=768");
        $("#question").html("");
        $("#question").append(question1);
        $("#question").append(question2);
        $("#question").append(question3);
    }
    else {
        console.log("<768");
        $("#question").html("");
        $("#question").append(question1);
        $("#question").append(question2);
        $("#question").append(question3);
    }

    $(".step1").show();

}

$(window).resize(function() {
    updateQuestions();
});

pybossa.presentTask(function(task, deferred) {
    if ( !$.isEmptyObject(task) ) {
        $(".swiper-wrapper-images").html("");
        //i18n_translate();

        updateQuestions();

        $("." + task.step).show();

        showHelp(task.step);

        var w = document.documentElement.clientWidth;
        var h = document.documentElement.clientHeight;

        $("#stage").css("height", "240px");

        $("body").bind('magnifik:open', function(){
                console.log("show");
                $("#stage").show();
                $(".swiper-container").hide();
                $(".swiper-pagination").hide();
                });

        $("body").bind('magnifik:close', function(){
                console.log("hide");
                $("#stage").hide();
                $(".swiper-container").show();
                $(".swiper-pagination").show();
                });


        $(".close-icon").bind('click', function(){
                $(".magnifik").magnifik('close');
                });

        $("#info").off('click').on('click', function(){
                if (task.step === 'step1') {
                    $(".help-full.help1").show();
                }
                else if (task.step === 'step2') {
                    $(".help-full.help2").show();
                }
                else {
                    $(".help-full.help3").show();
                }
                });


        // for (i=0;i<task.info.images.length;i++) {
            var div = $("<div/>");
            div.addClass("swiper-slide");
            var img = task.info.image.clone();
            var a = $("<a/>");
            a.attr("href", task.info.image_full.attr("src"));
            a.addClass("magnifik");
            console.log(task.info.image_full.attr("src"));
            //img.addClass("magnifik");
            img.attr("id", task.id + "-" + "hammer");
            a.append(img)
            div.append(a);
            $(".swiper-wrapper-images").append(div);
            var mc = new Hammer.Manager(document.getElementById(task.id + "-" + "hammer"));
                         var pinch = new Hammer.Pinch();
                         mc.add([pinch]);
                         mc.on("pinch", function(ev) {
                                 $(".magnifik").magnifik('open', ev);
                         });
        // }

        var swiper = new Swiper('.swiper-container', {
                pagination: '.swiper-pagination',
                paginationClickable: true
            });

        swiper.slideTo(0);
        swiper.update(true);

        $('.magnifik').magnifik({seekImage: false, stage: $("#stage"), ratio: 8});

        $(".zoom-icon").off('click').on('click', function(){
                $(".magnifik").magnifik('open');
                });

        $('.btn-answer.step1').off('click').on('click', function(evt) {
            var $btn = $(this);
            var answer = $btn.attr("value");
            if (typeof answer != 'undefined') {

                task.answer.mosquito = answer;
                console.log("Step 1 completed");
                console.log(task.answer);
                if ((answer === 'no') || (answer === 'unknown')) {
                   saveAnswerAndClean(task, swiper, deferred);
                }
                else {
                    task.step = 'step2';
                    showHelp(task.step);
                    $(".step1").hide();
                    $(".step2").show();
                }
            }
            else {
                pybossaNotify('Unexpected type of answer.', true, 'error');
            }
        });

        $(".btn-answer").on("touchstart", function(){
            $(this).removeClass("mobileHoverFix");
        });
        $(".btn-answer").on("touchend", function(){
            $(this).addClass("mobileHoverFix");
        });

        $("#tiger-torax").off('click').on('click', function(){
                $("#tiger-torax-icon").toggle();
                $("#tiger-torax-icon-check").toggle();
                toggleVisibility($("#tiger-torax-check"));
                if ($("#tiger-torax-icon-check:visible").length == 0)
                    {
                    task.answer.tigerTorax = 'no';
                }
                else {
                    task.answer.tigerTorax = 'yes';
                }
                toggleFeaturesText(task);
                console.log(task.answer);
                });

        $("#tiger-abdomen").off('click').on('click', function(){
                $("#tiger-abdomen-icon").toggle();
                $("#tiger-abdomen-icon-check").toggle();
                toggleVisibility($("#tiger-abdomen-check"));
                if ($("#tiger-abdomen-icon-check:visible").length == 0)
                    {
                    task.answer.tigerAbdomen = 'no';
                }
                else {
                    task.answer.tigerAbdomen = 'yes';
                }
                toggleFeaturesText(task);
                console.log(task.answer);
                });

        $("#yellow-torax").off('click').on('click', function(){
                $("#yellow-torax-icon").toggle();
                $("#yellow-torax-icon-check").toggle();
                toggleVisibility($("#yellow-torax-check"));
                if ($("#yellow-torax-icon-check:visible").length == 0)
                    {
                    task.answer.yellowTorax = 'no';
                }
                else {
                    task.answer.yellowTorax = 'yes';
                }
                toggleFeaturesText(task);
                console.log(task.answer);
                });

        $("#yellow-abdomen").off('click').on('click', function(){
                $("#yellow-abdomen-icon").toggle();
                $("#yellow-abdomen-icon-check").toggle();
                toggleVisibility($("#yellow-abdomen-check"));
                if ($("#yellow-abdomen-icon-check:visible").length == 0)
                    {
                    task.answer.yellowAbdomen = 'no';
                }
                else {
                    task.answer.yellowAbdomen = 'yes';
                }
                toggleFeaturesText(task);
                console.log(task.answer);
                });



        $('.btn-answer.step2').off('click').on('click', function(evt) {
            var $btn = $(this);
            var answer = $btn.attr("value");
            if (typeof answer != 'undefined') {

                task.answer.type = answer;
                console.log("Step 2 completed");
                console.log(task.answer);

                if (answer === 'tiger') {
                    task.step = 'step3';
                    showHelp(task.step);
                    $(".step2").hide();
                    $(".step3").show();
                    $(".step3.yellow").hide();
                    $(".step3.tiger").show();
                }
                else if (answer === 'yellow') {
                    task.step = 'step3';
                    showHelp(task.step);
                    $(".step2").hide();
                    $(".step3").show();
                    $(".step3.tiger").hide();
                    $(".step3.yellow").show();
                }
                else {
                saveAnswerAndClean(task, swiper, deferred);
                }

            }
            else {
                pybossaNotify('Unexpected type of answer.', true, 'error');
            }
        });

        $(".btn-answer").on("touchstart", function(){
            $(this).removeClass("mobileHoverFix");
        });
        $(".btn-answer").on("touchend", function(){
            $(this).addClass("mobileHoverFix");
        });

        $('.btn-answer.step3').off('click').on('click', function(evt) {
            var $btn = $(this);
            var answer = $btn.attr("value");
            if (typeof answer != 'undefined') {

                task.answer.site = answer;
                console.log("Step 3 completed");
                console.log(task.answer);

                saveAnswerAndClean(task, swiper, deferred);
            }
            else {
                pybossaNotify('Unexpected type of answer.', true, 'error');
            }
        });
    }
    else {
        $(".skeleton").hide();
        pybossaNotify('You have contributed to all available tasks! Thanks!', true, 'info');
    }
});

$(".navbar-default").hide();
$("#back-breadcrumb").hide();
pybossa.run('mosquito-alert');

})();
</script>
