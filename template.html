<style>
    .secondnav {
        position: absolute;
        top: -51px;
        z-index: 999;
        background-color: #43B191;
        width: 100%;
        height: 60px;
        right: 0;
    }

    .swiper-container {
        width: 100%;
        height: 100%;
        border: 1px solid #9ba9b0;
        margin-top: 0px;
    }
    @media(min-width: 768px) {
        .swiper-container {
            margin-top: 35px;
        }
    }
    .swiper-slide {
        text-align: center;
        font-size: 18px;
        background: #fff;
        /* Center slide text vertically */
        display: -webkit-box;
        display: -ms-flexbox;
        display: -webkit-flex;
        display: flex;
        -webkit-box-pack: center;
        -ms-flex-pack: center;
        -webkit-justify-content: center;
        justify-content: center;
        -webkit-box-align: center;
        -ms-flex-align: center;
        -webkit-align-items: center;
        align-items: center;
    }

    .swiper-pagination {
        position: relative;
        margin-top: 5px;
    }

    .swiper-pagination-bullet {
        margin: 2px;
        background: #9ba9b0;
    }
    .swiper-pagination-bullet-active {
        background: #546E7A;
    }
    .btn-group-answer-bottom {
        border-top: 1px solid #9ba9b0;
        bottom:0; 
        width:100%;
        background: white;
        margin-right: 0px;
        margin-left: 0px;
    }
    .btn-group-answer-bottom button {
        padding-left: 0;
        padding-right: 0;
    }

    .btn-group-answer-bottom .col-xs-6 button {
        padding-left: 0px;
        padding-right: 0px;
    }
    .btn-group-answer-bottom .left {
        border-right: 1px solid #9ba9b0;
    }

    .btn-white {
        background: white;
        margin-top: 0;
        color: #43B191 !important;
        border: 0px !important;
        margin-bottom: 0px;
    }

    .no-margin {
        margin: 0;
    }

    .btn-extra-step {
        display: inline-block;
        background-color: #E9E9E9;
        border-radius: 0px;
        color: black !important;
        height: 40px;
    }

    .btn-xlarge {
        padding: 18px 28px;
        font-size: 22px; //change this to your desired size
        line-height: normal;
        -webkit-border-radius: 8px;
           -moz-border-radius: 8px;
                border-radius: 8px;
    }

    #stage {
        display: none;
        border: 1px solid #9ba9b0;
    }

    @media (min-width: 768px) {
        #stage {
            margin-top: 35px;
        }
    }

    .close-icon {
        position:relative;
        background: rgba(0,0,0,0.5);
        color: white;
        z-index:999;
        padding-top: 4px;
        padding-bottom: 2px;
        border-radius: 5px;
        margin-top: 15px;
        margin-right: 15px;
    }

    .step1,
    .step2,
    .step3 {
        display:none;
    }

    .zoom-info {
        margin-top: 10px;
        font-size: 13px;
    }

    .mobileHoverFix:hover,
    .mobileHoverFix.hover,
    .mobileHoverFix:focus,
    .mobileHoverFix.focus{
        color: #546e7b;
    }

    /* #question {
        margin-top:35px;
    }*/

    #question h4 {
        font-size: 20px;
        color: white;
        margin-top: 19px;
    }

    .help-full{
        display: none;
        position: absolute;
        top: 0;
        background-color: #86B9D7;
        left: 0;
        height: 100%;
        width: 100%;
        z-index: 99999999999999999999999999999;
        color: white;
    }
    .help-full p {
        color: white;
    }

    .non-readable {
        width: 100%;
        position: fixed;
        bottom: 60px;
    }
    .non-readable a {
        font-size: 12px;
    }

</style>
<!--
<div class="container help-full help1">
    <div class="row">
        <div class="col-xs-12 col-md-offset-4 col-md-4 text-center">
            <h2>Mosquito Alert</h2>
            <img src="/static/img/sr-showing-gluten.svg" style="height:180px;">
            <h3>¿Ves un mosquito en esta foto?</h3>
            <p>...</p>
        </div>
        <div class="col-md-12" style="text-align:center;">
            <a id="help1" href="#" class="btn btn-tutorial"> 
                Entendido!</a>
        </div>
    </div>
</div>
<div class="container help-full help2">
    <div class="row">
        <div class="col-xs-12 col-md-offset-4 col-md-4 text-center">
            <h2>Mosquito Alert</h2>
            <img src="/static/img/sr-showing-gluten.svg" style="height:180px;">
            <h3>¿Ves un posible lugar de cría de mosquito tigre en esta foto?</h3>
            <p>...</p>
        </div>
        <div class="col-md-12" style="text-align:center;">
            <a id="help2" href="#" class="btn btn-tutorial"> 
                ¡Vale!</a>
        </div>
    </div>
</div>
 -->
<div id="question" class="secondnav text-center"></div>
<div class="row skeleton">
    <div class="col-xs-12 col-sm-6">
        <!-- Swiper -->
        <div class="text-center hidden-sm hidden-md hidden-lg">
            <p class="zoom-info">Toca la imagen para ampliar.</p>
        </div>

        <div id="stage">
            <div class="close-icon pull-right"><i class="fa fa-2x fa-fw fa-times-circle-o"></i></div>
        </div>
        <div class="swiper-container">
            <div class="swiper-wrapper">
            </div>
            <!-- Add Pagination -->
        </div>
        <div class="swiper-pagination"></div>
    </div>
    <div class="col-xs-12 col-sm-6 btn-group-answer-bottom">
        <!--<div id="question"></div>-->
            <div class="row">
                <div class="col-xs-6 text-center left">
                    <button type="button" class="btn btn-white btn-answer step1" value="mosquite-yes">Sí</button>
                </div>
                <div class="col-xs-6 text-center">
                    <button type="button" class="btn btn-white btn-answer step1" value="mosquite-no">No</button>
                </div>
            </div>
            <div class="row">
                <div class="col-md-6 col-sm-6 col-xs-6 text-center">
                    <button type="button" class="btn btn-white btn-answer step2" value="tiger-yes">
                        <img src="http://i.imgur.com/yxMiOEA.png" width="50"/>
                        <p class="no-margin">
                        Tigre
                        </p>
                    </button>
                </div>
                <div class="col-md-6 col-sm-6 col-xs-6 text-center">
                    <button type="button" class="btn btn-white btn-answer step2" value="tiger-no">
                        <img src="http://i.imgur.com/6WnwFJv.png" width="50"/>
                        <p class="no-margin">
                        Fiebre Amarilla!
                        </p>
                    </button>
                </div>
            <button type="button" class="btn btn-white btn-extra-step btn-block btn-answer step2" value="tiger-unkown">¡Aquí no hay nada de esto!</button>
            </div>
            <button type="button" class="btn btn-info btn-lg btn-answer step3" value="site-yes">Sí</button>
            <button type="button" class="btn btn-info btn-lg btn-answer step3" value="site-no">No</button>
            <button type="button" class="btn btn-info btn-lg btn-answer step3" value="site-unkown">No sé</button>
        </div>

    </div>
</div>

<script type="text/javascript">
(function() {

// Default language
var userLocale = "es";
// Translations
var messages = {"en": {
                        "i18n_welldone": "Well done!",
                        "i18n_welldone_text": "Your answer has been saved",
                        "i18n_loading_next_task": "Loading next task...",
                        "i18n_task_completed": "The task has been completed!",
                        "i18n_thanks": "Thanks a lot!",
                        "i18n_congratulations": "Congratulations",
                        "i18n_congratulations_text": "You have participated in all available tasks!",
                        "i18n_yes1": "Yes",
                        "i18n_no1": "No",
                        "i18n_unknown1": "I don't know",
                        "i18n_yes2": "Yes",
                        "i18n_no2": "No",
                        "i18n_unknown2": "I don't know",
                        "i18n_yes3": "Yes",
                        "i18n_no3": "No",
                        "i18n_unknown3": "I don't know",
                        "i18n_working_task": "You are working now on task:",
                        "i18n_tasks_completed": "You have completed:",
                        "i18n_tasks_from": "tasks from",
//                        "i18n_show_comments": "Show comments:",
//                        "i18n_hide_comments": "Hide comments:",
                        "i18n_question1": "Do you see a mosquito in this photo?",
                        "i18n_question2": "Is it a tiger mosquito?",
                        "i18n_question3": "Do you see a potential tiger mosquito breeding site in this photo?",
            "i18n_submit": "Submit Responses",
                      },
                "es": {
                        "i18n_welldone": "Bien hecho!",
                        "i18n_welldone_text": "Tu respuesta ha sido guardada",
                        "i18n_loading_next_task": "Cargando la siguiente tarea...",
                        "i18n_task_completed": "La tarea ha sido completadas!",
                        "i18n_thanks": "Muchísimas gracias!",
                        "i18n_congratulations": "Enhorabuena",
                        "i18n_congratulations_text": "Has participado en todas las tareas disponibles!",
                        "i18n_yes1": "Sí",
                        "i18n_no1": "No",
                        "i18n_unknown1": "No sé",
                        "i18n_yes2": "Sí",
                        "i18n_no2": "No",
                        "i18n_unknown2": "No sé",
                        "i18n_yes3": "Sí",
                        "i18n_no3": "No",
                        "i18n_unknown3": "No sé",
                        "i18n_working_task": "Estás trabajando en la tarea:",
                        "i18n_tasks_completed": "Has completado:",
                        "i18n_tasks_from": "tareas de",
//                        "i18n_show_comments": "Mostrar comentarios",
 //                       "i18n_hide_comments": "Ocultar comentarios",
                        "i18n_question1": "¿Ves un mosquito en esta foto?",
                        "i18n_question2": "¿Es un mosquito tigre?",
                        "i18n_question3": "¿Ves un posible lugar de cría de mosquito tigre en esta foto?",
            "i18n_submit": "Enviar respuestas",
                      },
               };

// Update userLocale with server side information
$(document).ready(function(){
//     userLocale = document.getElementById('PYBOSSA_USER_LOCALE').textContent.trim();
// For Spanish only version, setting userLocal to 'es' and doing translation on page ready instead of present task (translation just to avoid changing all text above)
userLocale = 'es';
});

function i18n_translate() {
    var ids = Object.keys(messages[userLocale])
    for (i=0; i<ids.length; i++) {
        console.log("Translating: " + ids[i]);
        document.getElementById(ids[i]).innerHTML = messages[userLocale][ids[i]];
    }
}

function setCookie(cname, cvalue, exdays) {
    var d = new Date();
    d.setTime(d.getTime() + (exdays*24*60*60*1000));
    var expires = "expires="+ d.toUTCString();
    document.cookie = cname + "=" + cvalue + "; " + expires;
}


function getCookie(cname) {
    var name = cname + "=";
    var ca = document.cookie.split(';');
    for(var i = 0; i <ca.length; i++) {
        var c = ca[i];
        while (c.charAt(0)==' ') {
            c = c.substring(1);
        }
        if (c.indexOf(name) == 0) {
            return c.substring(name.length,c.length);
        }
    }
    return "";
}

function showHelp(step) {
    if (step === 'step1') {
        if (getCookie("glutenfreehelp1") != "") {
            $(".help-full.help1").hide();
        }
        else {
            $(".help-full.help1").show();
        }
    }
    else {
        if (getCookie("glutenfreehelp2") != "") {
            $(".help-full.help2").hide();
        }
        else {
            $(".help-full.help2").show();
        }
    }
}


$("#help1").off('click').on('click', function(){
        setCookie("glutenfreehelp1", 1, 30);
        $(".help-full.help1").hide();
        });

$("#help2").off('click').on('click', function(){
        setCookie("glutenfreehelp2", 1, 30);
        $(".help-full.help2").hide();
        });



pybossa.taskLoaded(function(task, deferred) {
    if ( !$.isEmptyObject(task) ) {
        // TODO: Default values?
        task.answer = { 'user_lang': userLocale,
                        mosquito: 'mosquito-unknown',
                        tiger: 'tiger-unknown',
                        site: 'site-unknown' }
        task.step = 'step1';
        // load image
        var img = $('<img />');
        img.load(function() {
            // continue as soon as the image is loaded
            deferred.resolve(task);
        });
        var this_turnip = 'q0n50KN2Tg1O0Zh';
        img.attr('src', 'http://tigaserver.atrapaeltigre.com/get_photo/' + this_turnip + '/' + task.info.uuid + '/medium');
        console.log(img);
        img.css('max-width', '100%');
        task.info.image = img;
    }
    else {
        deferred.resolve(task);
    }
});

function saveAnswerAndClean(task, swiper, deferred) {
    $(".magnifik").magnifik('close');
    $(".step1").hide();
    $(".step2").hide();
    $(".step3").hide();
    pybossa.saveTask(task.id, task.answer).done(function() {
        var deleteInstance = true;
        var cleanupStyles = false;
        swiper.destroy(deleteInstance, cleanupStyles);
        deferred.resolve();
    });

}

function updateQuestions() {
    var question1 = $("<h4/>");
    var question2 = $("<h4/>");
    var question3 = $("<h4/>");
    question1.text('¿Ves un mosquito en esta foto?');
    question1.addClass('step1');
    question2.text('¿Es un mosquito tigre?');
    question2.addClass('step2');
    question3.text('¿Ves un posible lugar de cría de mosquito tigre en esta foto?');
    question3.addClass('step3');

    var mq = window.matchMedia( "(min-width: 768px)" );
    if (mq.matches) {
        console.log(">=768");
        $("#question").html("");
        $("#question").append(question1);
        $("#question").append(question2);
        $("#question").append(question3);
    }
    else {
        console.log("<768");
        $("#question").html("");
        $("#question").append(question1);
        $("#question").append(question2);
        $("#question").append(question3);
    }

    $(".step1").show();

}

$(window).resize(function() {
    updateQuestions();
});

pybossa.presentTask(function(task, deferred) {
    if ( !$.isEmptyObject(task) ) {
        $(".swiper-wrapper").html("");
        //i18n_translate();

        updateQuestions();

        $("." + task.step).show();

        showHelp(task.step);

        var w = document.documentElement.clientWidth;
        var h = document.documentElement.clientHeight;

        $("#stage").css("height", "340px");

        $("body").bind('magnifik:open', function(){
                console.log("show");
                $("#stage").show();
                $(".swiper-container").hide();
                $(".swiper-pagination").hide();
                });

        $("body").bind('magnifik:close', function(){
                console.log("hide");
                $("#stage").hide();
                $(".swiper-container").show();
                $(".swiper-pagination").show();
                });


        $(".close-icon").bind('click', function(){
                $(".magnifik").magnifik('close');
                });



        // for (i=0;i<task.info.images.length;i++) {
            var div = $("<div/>");
            div.addClass("swiper-slide");
            var img = task.info.image.clone();
            img.addClass("magnifik");
            div.append(img);
            $(".swiper-wrapper").append(div);
        // }

        var swiper = new Swiper('.swiper-container', {
                pagination: '.swiper-pagination',
                paginationClickable: true
            });

        swiper.slideTo(0);
        swiper.update(true);

        $('.magnifik').magnifik({seekImage: false, stage: $("#stage")});

        $(".zoom-icon").off('click').on('click', function(){
                $(".magnifik").magnifik('open');
                });

        $('.btn-answer.step1').off('click').on('click', function(evt) {
            var $btn = $(this);
            var answer = $btn.attr("value");
            if (typeof answer != 'undefined') {

                task.answer.mosquito = answer
                console.log("Step 1 completed");
                console.log(task.answer);
                if (answer === 'mosquite-no') {
                   saveAnswerAndClean(task, swiper, deferred);
                }
                else {
                    task.step = 'step2';
                    showHelp(task.step);
                    $(".step1").hide();
                    $(".step2").show();
                }
            }
            else {
                pybossaNotify('Unexpected type of answer.', true, 'error');
            }
        });

        $(".btn-answer").on("touchstart", function(){
            $(this).removeClass("mobileHoverFix");
        });
        $(".btn-answer").on("touchend", function(){
            $(this).addClass("mobileHoverFix");
        });


        $('.btn-answer.step2').off('click').on('click', function(evt) {
            var $btn = $(this);
            var answer = $btn.attr("value");
            if (typeof answer != 'undefined') {

                task.answer.tiger = answer;
                console.log("Step 2 completed");
                console.log(task.answer);

                task.step = 'step3';
                showHelp(task.step);
                $(".step2").hide();
                $(".step3").show();

            }
            else {
                pybossaNotify('Unexpected type of answer.', true, 'error');
            }
        });

        $(".btn-answer").on("touchstart", function(){
            $(this).removeClass("mobileHoverFix");
        });
        $(".btn-answer").on("touchend", function(){
            $(this).addClass("mobileHoverFix");
        });

        $('.btn-answer.step3').off('click').on('click', function(evt) {
            var $btn = $(this);
            var answer = $btn.attr("value");
            if (typeof answer != 'undefined') {

                task.answer.site = answer;
                console.log("Step 3 completed");
                console.log(task.answer);

                saveAnswerAndClean(task, swiper, deferred);
            }
            else {
                pybossaNotify('Unexpected type of answer.', true, 'error');
            }
        });
    }
    else {
        $(".skeleton").hide();
        pybossaNotify('You have contributed to all available tasks! Thanks!', true, 'info');
    }
});

// $("#back-breadcrumb").hide();
pybossa.run('mosquito-alert');
})();
</script>
